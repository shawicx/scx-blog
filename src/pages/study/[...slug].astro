---
import PostList from '@/components/PostList.astro'
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getCollection('posts')

  // 过滤学习记录相关的文章
  const studyPosts = posts.filter(post =>
    post.id.includes('scattered-notes/') &&
    (!post.data.draft || import.meta.env.DEV)
  )

  return [
    {
      params: { slug: undefined },
      props: {
        posts: studyPosts,
        title: '学习记录',
        description: '技术学习和开发过程中的零散记录和思考'
      },
    },
  ]
}

const { posts, title, description } = Astro.props

// 按年份分组
const postsByYear = new Map()
posts.forEach(post => {
  const year = new Date(post.data.published).getFullYear()
  if (!postsByYear.has(year)) {
    postsByYear.set(year, [])
  }
  postsByYear.get(year).push(post)
})

// 按年份排序（最新的在前）
const sortedYears = Array.from(postsByYear.keys()).sort((a, b) => b - a)
---

<Layout>
  <div class="mb-8">
    <h1 class="text-6 font-bold mb-4 c-primary">{title}</h1>
    <p class="text-4 c-secondary">{description}</p>
  </div>

  {sortedYears.map(year => (
    <section class="mb-7.5">
      <div class="uno-decorative-line" />
      <PostList posts={postsByYear.get(year)} lang="zh" />
    </section>
  ))}
</Layout>
