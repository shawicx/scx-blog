---
import { getPageInfo } from '@/utils/page'

const { isHome, isPost } = getPageInfo(Astro.url.pathname)
const currentPath = Astro.url.pathname

// 判断当前页面类型
const isWorkActive = currentPath.startsWith('/work/')
const isStudyActive = currentPath.startsWith('/study/')
const isHomeActive = isHome

function getNavItemClass(isActive: boolean) {
  return isActive
    ? 'highlight-static c-primary font-bold after:bottom-0.7em'
    : 'highlight-hover transition-[colors,font-weight] after:bottom-0.7em hover:(c-primary font-bold)'
}

const navItems = [
  {
    href: '/',
    label: '首页',
    className: getNavItemClass(isHomeActive),
  },
  {
    href: '/work/',
    label: '工作记录',
    className: getNavItemClass(isWorkActive),
    children: [
      { href: '/work/uniubi/', label: '宇泛' },
      { href: '/work/viewshine/', label: '威星' },
    ]
  },
  {
    href: '/study/',
    label: '学习记录',
    className: getNavItemClass(isStudyActive),
  },
]
---

<nav
  aria-label="Site Navigation"
  class:list={[
    isPost ? 'hidden lg:block' : '',
    'fixed top-20 left-0 right-0 z-40 bg-white dark:bg-dark',
    'border-b border-gray-200 dark:border-gray-700',
    'px-[min(7.25vw,3.731rem)] lg:px-[max(5.75rem,calc(50vw-34.25rem))]',
  ]}
>
  <div class="mx-auto max-w-205.848 lg:max-w-[min(calc(75vw-16rem),44rem)]">
    <ul class="flex items-center space-x-8 h-14.4 text-3.6 font-semibold leading-2.45em font-navbar cjk:tracking-0.02em">
      {navItems.map(item => (
        <li class="relative group">
          <a
            href={item.href}
            class={item.className}
          >
            {item.label}
          </a>
          {item.children && (
            <ul class="absolute top-full left-0 min-w-32 bg-white dark:bg-dark border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
              {item.children.map(child => (
                <li>
                  <a
                    href={child.href}
                    class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                  >
                    {child.label}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>
  </div>
</nav>
